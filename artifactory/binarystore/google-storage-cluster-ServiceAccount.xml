<!--
##############################
Name: Google Storage - Cluster
Authentication: ServiceAccount

Valid for: Artifactory HA
Reference: https://www.jfrog.com/confluence/display/JFROG/Google+Cloud+Storage#GoogleCloudStorage-GoogleStorageClusterBinaryProvider
##############################
-->

<config version="2">
    <chain>
        <provider id="cache-fs" type="cache-fs">
            <provider id="sharding-cluster" type="sharding-cluster">
                <readBehavior>crossNetworkStrategy</readBehavior>
                <writeBehavior>crossNetworkStrategy</writeBehavior>
                <redundancy>3</redundancy>
                <minSpareUploaderExecutor>2</minSpareUploaderExecutor>
                <sub-provider id="eventual-cluster" type="eventual-cluster">
                    <provider id="retry" type="retry">
                        <provider id="google-storage-v2" type="google-storage-v2"/>
                    </provider>
                </sub-provider>
                <dynamic-provider id="remote" type="remote"/>
                <property name="zones" value="local,remote"/>
            </provider>
        </provider>
    </chain>
  
    <!-- Set max cache-fs size -->
    <provider id="cache-fs" type="cache-fs">
        <maxCacheSize>5e+10</maxCacheSize>
        <cacheProviderDir>cache</cacheProviderDir>
    </provider>
  
    <provider id="eventual-cluster" type="eventual-cluster">
        <zone>local</zone>
    </provider>
  
    <provider id="remote" type="remote">
        <checkPeriod>30</checkPeriod>
        <timeout>10000</timeout>
        <zone>remote</zone>
    </provider>
  
    <provider id="file-system" type="file-system">
        <fileStoreDir>/var/opt/jfrog/artifactory/data/filestore</fileStoreDir>
        <tempDir>/tmp</tempDir>
    </provider>
  
    <provider id="google-storage-v2" type="google-storage-v2">
        <useInstanceCredentials>false</useInstanceCredentials>
        <providerId>google-cloud-storage</providerId>
        <endpoint>commondatastorage.googleapis.com</endpoint>
        <httpsOnly>false</httpsOnly>
        <bucketName>artifactory-ha-gcp</bucketName>
        <path>artifactory-ha/filestore</path>
        <bucketExists>false</bucketExists>
    </provider>
</config>
